**已看章节**- 1-5章  ​**正在看**- 7 ok- 8 p174- 9- 10- 12- 13- 14- 15​**不用看**- 第6章,11章,16章

# 独立性检验
In [ ]:
# 卡方独立性检验library(vcd)ar <- Arthritis
In [ ]:
# treatment和imporved不独立table1 <- xtabs(~Treatment+Improved,data=ar)chisq.test(table1)
In [ ]:
# sex和imporved独立table2 <- xtabs(~Improved+Sex,data=ar)chisq.test(table2)
In [ ]:
# fisher精确检验fisher.test(table1)
In [ ]:
fisher.test(table2)
In [ ]:
# Cochran—Mantel—Haenszel卡方检验table3 <- xtabs(~Treatment+Improved+Sex,data=ar)mantelhaen.test(table3)# 结果表明，患者接受的治疗与得到的改善在性别的每一水平下并不独立
In [ ]:
# 计算相关性度量assocstats(table1)


# 相关
In [ ]:
# cor(x,use= , method= )# use: all.obs,everything,complete.obs(行删除),#      pairwise.complete.obs(成对删除)# method: pearson,spearman,kendall
In [ ]:
states <- state.x77[,1:6]# 方差与协方差cov(states)
In [ ]:
# pearson相关系数cor(states)
In [ ]:
# Population与其他变量的spearman等级相关系数cor(states,states[,"Population"],method="spearman")
# 相关性的显著性实验
In [ ]:
# cor.test()函数对单个的Pearson、Spearman和Kendall相关系数进行检验# cor.test(x,y,alternative= , method= )# alternative则用来指定进行双侧检验或单侧检验# "two.side"、"less"或"greater"
In [ ]:
cor.test(states[,"Life Exp"],states[,"Murder"])# 原假设"两者的相关度为0",P值2.26e-11# murder和life exp的相关度的95%置信区间是[-0.8700837,-0.6420442]
# 最小二乘法OLS # 线性回归
In [ ]:
# 简单线性回归fit1 <- lm(weight ~ height,data=women)fit1
In [ ]:
summary(fit1)
In [ ]:
head(residuals(fit1))
In [ ]:
plot(women$heigh,women$weight)abline(fit1)
In [ ]:
# 多项式回归fit2 <- lm(weight ~ height + I(height^2), data=women)fit2
In [ ]:
summary(fit2)
In [ ]:
plot(women$heigh,women$weight)lines(women$height,fitted(fit2))
In [ ]:
# 多元线性回归states <- as.data.frame(state.x77[,c(1,2,3,5,7)])
In [ ]:
library(car)scatterplotMatrix(states,spread=FALSE)
In [ ]:
fit3 <- lm(Murder ~ Population + Illiteracy + Income + Frost,         data=states)fit3
In [ ]:
summary(fit3)
In [ ]:
# 有交互项的多元线性回归fit4 <- lm(mpg ~ hp + wt + hp:wt, data=mtcars)fit4
In [ ]:
summary(fit4)
In [ ]:
library(effects)plot(effect("hp:wt", fit4, xlevels=list(wt=c(2.2,3.2,4.2))),    multiline=TRUE)# 随着车重的增加，马力与每加仑汽油行驶英里数的关系减弱了



# 回归诊断
置信区间
In [ ]:
confint(fit3)
结果表明，文盲率改变1%，谋杀率就在95%的置信区间[2.38,5.90]中变化。另外，因为Frost的置信区间包含0，可以得出结论说，当其他变量不变时，温度的改变与谋杀率无关。不过，你对这些结果的信念，都只建立在你的数据满足统计假设的前提之上。
- 通过图形检验回归分析
In [ ]:
# 通过图形检验回归分析par(mfrow = c(2,2))plot(fit1)
1. 正态性 当预测变量值固定时，因变量成正态分布，则残差值也应该是一个均值为0的正态分布。正态Q-Q图（Normal Q-Q，右上）是在正态分布对应的值下，标准化残差的概率图。若满足正态假设，那么图上的点应该落在呈45度角的直线上；若不是如此，那么就违反了正态性的假设。2. 独立性 你无法从这些图中分辨出因变量值是否相互独立，只能从收集的数据中来验证。上面的例子中，没有任何先验的理由去相信一位女性的体重会影响另外一位女性的体重。假若你发现数据是从一个家庭抽样得来的，那么可能必须要调整模型独立性的假设。3. 线性 若因变量与自变量线性相关，那么残差值与预测（拟合）值就没有任何系统关联。换句话说，除了白噪声，模型应该包含数据中所有的系统方差。在“残差图与拟合图”（Residuals vs Fitted，左上）中可以清楚的看到一个曲线关系，这暗示着你可能需要对回归模型加上一个二次项。4. 同方差性 若满足不变方差假设，那么在位置尺度图（Scale-Location Graph，左下）中，水平线周围的点应该随机分布。该图似乎满足此假设。5. 最后一幅“残差与杠杆图”（Residuals vs Leverage，右下）提供了你可能关注的单个观测点的信息。从图形可以鉴别出离群点、高杠杆值点和强影响点。下面来详细介绍。    1. 一个观测点是离群点，表明拟合回归模型对其预测效果不佳（产生了巨大的或正或负的残差）。    2. 一个观测点有很高的杠杆值，表明它是一个异常的预测变量值的组合。也就是说，在预测变量空间中，它是一个离群点。因变量值不参与计算一个观测点的杠杆值。    3. 一个观测点是强影响点（influential observation），表明它对模型参数的估计产生的影响过大，非常不成比例。强影响点可以通过Cook距离即Cook’s D统计量来鉴别。
In [ ]:
# 通过图形检验回归分析par(mfrow = c(2,2))plot(fit2)
In [ ]:
# 通过图形检验回归分析par(mfrow = c(2,2))plot(fit3)
- 改进的方法
In [ ]:
# car包提供了大量函数，大大增强了拟合和评价回归模型的能力# gvlma包提供了对所有线性模型假设进行检验的方法
- qqplot
In [ ]:
# qqplot 已有
- 误差的独立性 Drubin-Watson检验
In [ ]:
durbinWatsonTest(fit3)# p值不显著说明无自相关性，误差项之间独立
- 偏残差图
In [ ]:
# 通过成分残差图（component plus residual plot）# 也称偏残差图（partial residual plot），# 你可以看看因变量与自变量之间是否呈非线性关系，# 也可以看看是否有不同于已设定线性模型的系统偏差
In [ ]:
car::crPlots(fit3)
- 判断误差方差是否恒定
In [ ]:
car::ncvTest(fit3)# 生成一个计分检验，零假设为误差方差不变，# 备择假设为误差方差随着拟合值水平的变化而变化。# 若检验显著，则说明存在异方差性（误差方差不恒定）
In [ ]:
car::spreadLevelPlot(fit3)# 分布水平图# 点在水平的最佳拟合曲线周围呈水平随机分布# 若违反了该假设,你将会看到一个非水平的曲线
In [ ]:
# p203
In [ ]:
​
In [ ]:
​